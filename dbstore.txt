-- 1. Criar tabela stores
CREATE TABLE stores (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  business_name TEXT,
  description TEXT,
  category TEXT NOT NULL,
  cnpj TEXT UNIQUE,
  logo_url TEXT,
  banner_url TEXT,
  email TEXT,
  phone TEXT,
  address JSONB,
  business_hours JSONB,
  is_approved BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 4. Alterar product_listings para referenciar stores
ALTER TABLE product_listings ADD COLUMN store_id UUID NOT NULL REFERENCES stores(id) ON DELETE CASCADE;


-- 3. Adicionar colunas de auditoria
ALTER TABLE order_items
ADD COLUMN IF NOT EXISTS status_updated_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS status_updated_by UUID REFERENCES users(id);
